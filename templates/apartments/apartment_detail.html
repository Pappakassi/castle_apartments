{% extends "base.html" %}

{% block title %}{{ apartment.title }} - Details{% endblock %}

{% block content %}
    <div class="container-fluid px-0">
        {% include 'apartments/_slides.html' %}
    </div>
    <section>
        <div class="container">
            <!--
            <div class="apt-address">{{ apartment.address }}</div>
            <h2>{{ apartment.title }}</h2>

            <p class="apt-price">ISK {{ apartment.listing_price|floatformat:0 }}</p>
            <p class="card-title"><strong>Status:</strong> {% if apartment.is_sold %}SOLD{% else %}For Sale{% endif %}</p>
            <p class="card-title">{{ apartment.description }}</p>
            -->
            <div class="property-card">
                {# ‚úÖ Favorite Button Section #}
              <div class="property-header">
                <div class="property-location">
                  <span class="icon"><img src="../../static/images/location.png"></span>
                  <strong>Heklum√Ωri 15, 105 Reykjav√≠k</strong>
                </div>
                <div class="property-price">
                  38,300,000 kr.
                </div>
              </div>
                <div class="property-info">
                    <div>{{ apartment.num_rooms }} Rooms</div>
                    <div>{{ apartment.square.meters }} m¬≤</div>
                    <div>{{ apartment.num_bedrooms }} Bedrooms </div>
                    <div>{{ apartment.num_bathrooms }} Bathrooms</div>
                </div>
                {% if user.is_authenticated and user.buyer %}
                    {% if apartment in user.buyer.favorites.all %}
                        <form method="post" action="{% url 'unfavorite' apartment.id %}">
                            {% csrf_token %}
                            <button type="submit">üíî Remove from Favorites</button>
                        </form>
                    {% else %}
                        <form method="post" action="{% url 'favorite' apartment.id %}">
                            {% csrf_token %}
                            <button type="submit">‚ù§Ô∏è Add to Favorites</button>
                        </form>
                    {% endif %}
                {% endif %}
                <div class="property-description">
                    <strong>Detail:</strong><br>
                    Lorem Ipsum is simply dummy text of the printing and typesetting industry.<br>
                    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer<br>
                    took a galley of type and scrambled it to make a type specimen book. It has survived<br>
                    not only five centuries, but also the leap into electronic typesetting,<br>
                    remaining essentially unchanged.
                </div>
            </div>



            {# Edit/Delete Buttons (if you have permission) #}
            <form action="{% url 'delete_apartment' apartment.pk %}" method="post" style="display:inline;">
              {% csrf_token %}
              <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this apartment?');">
                Delete Apartment
              </button>
            </form>

            <a href="{% url 'update_apartment' apartment.pk %}" class="btn btn-sm btn-outline-secondary" style="margin-left: 10px;">
                Edit Apartment
            </a>

            <a href="{% url 'apartments_list' %}" style="display:inline-block; margin-top:20px; padding:8px 16px; background-color:#2B1B12; color:white; text-decoration:none; border-radius:4px;">
                ‚Üê Back to All Apartments
            </a>


            {% if apartment.seller %}
              <p class="card-text">
                Seller:
                <a href="{% url 'seller_detail' apartment.seller.id %}">
                  {{ apartment.seller.name }}
                </a>
              </p>
            {% endif %}

            {% if user.is_authenticated and not apartment.is_sold %}
              {% if offer %}
                <a class="btn btn-warning" href="{% url 'submit_offer' apartment.id %}">
                  Resubmit a Purchase Offer
                </a>
                <span class="badge bg-info text-dark ms-2">Status: {{ offer.status }}</span>
              {% else %}
                <a class="btn btn-success" href="{% url 'submit_offer' apartment.id %}">
                  Submit a Purchase Offer
                </a>
              {% endif %}
            {% elif not user.is_authenticated and not apartment.is_sold %}
              <p>Please <a href="{% url 'login' %}">log in</a> to submit a purchase offer.</p>
            {% endif %}
        </div>
    </section>
{% endblock %}
