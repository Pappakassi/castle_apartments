{% extends "base.html" %}

{% block title %}{{ apartment.title }} - Details{% endblock %}

{% block content %}
    <h2>{{ apartment.title }}</h2>

    <img src="{{ apartment.image|default:'https://placehold.co/600x400?text=No+Image' }}" alt="{{ apartment.title }}" style="width:600px; margin-bottom:20px;">

    <h5 class="card-title"><strong>Address:</strong> {{ apartment.address }}</h5>
    <p class="card-title"><strong>Price:</strong> ISK {{ apartment.listing_price|floatformat:0 }}</p>
    <p class="card-title"><strong>Status:</strong> {% if apartment.is_sold %}SOLD{% else %}For Sale{% endif %}</p>
    <p class="card-title">{{ apartment.description }}</p>

    {# ‚úÖ Favorite Button Section #}
    {% if user.is_authenticated and user.buyer %}
        {% if apartment in user.buyer.favorites.all %}
            <form method="post" action="{% url 'unfavorite' apartment.id %}">
                {% csrf_token %}
                <button type="submit">üíî Remove from Favorites</button>
            </form>
        {% else %}
            <form method="post" action="{% url 'favorite' apartment.id %}">
                {% csrf_token %}
                <button type="submit">‚ù§Ô∏è Add to Favorites</button>
            </form>
        {% endif %}
    {% endif %}

    {# Edit/Delete Buttons (if you have permission) #}
    <form action="{% url 'delete_apartment' apartment.pk %}" method="post" style="display:inline;">
      {% csrf_token %}
      <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this apartment?');">
        Delete Apartment
      </button>
    </form>

    <a href="{% url 'update_apartment' apartment.pk %}" class="btn btn-sm btn-outline-secondary" style="margin-left: 10px;">
        Edit Apartment
    </a>

    <a href="{% url 'apartments_list' %}" style="display:inline-block; margin-top:20px; padding:8px 16px; background-color:#2B1B12; color:white; text-decoration:none; border-radius:4px;">
        ‚Üê Back to All Apartments
    </a>

<!-- Additional Images Gallery -->
<h3>Gallery</h3>
<div style="display: flex; flex-wrap: wrap; gap: 1rem;">
  {% for image in apartment.images.all %}
    <div>
      <img src="{{ image.image_url }}" alt="{{ image.caption }}" style="width: 200px; height: auto;">
      <p>{{ image.caption }}</p>
    </div>
  {% empty %}
    <p>No additional images available.</p>
  {% endfor %}
</div>


{% if apartment.seller %}
  <p class="card-text">
    Seller:
    <a href="{% url 'seller_detail' apartment.seller.id %}">
      {{ apartment.seller.name }}
    </a>
  </p>
{% endif %}

{% if user.is_authenticated and not apartment.is_sold %}
  {% if offer %}
    <a class="btn btn-warning" href="{% url 'submit_offer' apartment.id %}">
      Resubmit a Purchase Offer
    </a>
    <span class="badge bg-info text-dark ms-2">Status: {{ offer.status }}</span>
  {% else %}
    <a class="btn btn-success" href="{% url 'submit_offer' apartment.id %}">
      Submit a Purchase Offer
    </a>
  {% endif %}
{% elif not user.is_authenticated and not apartment.is_sold %}
  <p>Please <a href="{% url 'login' %}">log in</a> to submit a purchase offer.</p>
{% endif %}


{% endblock %}
